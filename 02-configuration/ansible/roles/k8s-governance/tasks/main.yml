---
- name: Apply Resource Quotas to Namespaces
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'resource-quota.yaml.j2') }}"
  loop:
    - { name: 'development', cpu_req: '500m', mem_req: '512Mi', cpu_lim: '1', mem_lim: '1Gi', pods: '10' }
    - { name: 'staging',     cpu_req: '1',    mem_req: '1Gi',   cpu_lim: '2', mem_lim: '2Gi', pods: '20' }
    - { name: 'production',  cpu_req: '2',    mem_req: '2Gi',   cpu_lim: '4', mem_lim: '4Gi', pods: '50' }

- name: Apply Network Policies to Namespaces
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'network-policy.yaml.j2') }}"
  loop:
    - { name: 'development' }
    - { name: 'staging' }
    - { name: 'production' }
